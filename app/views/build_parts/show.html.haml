= content_for :title, "#{@build_part.id}/#{@build.ref}"
= content_for :favicon do
  = favicon_link_tag image_path("#{@build_part.to_color}.png"), :type => 'image/png'

%h2.subheader
  = link_to(@build.project.name, project_path(@build.project))
  \-
  = link_to "Build #{@build.id}", project_build_path(@project, @build)
  \- <code>#{@build.ref}</code> - Part #{@build_part.id}

%table.build-part-info
  %thead
    %tr
      %th Attempt #
      %th Status
      %th Started At
      %th.right Elapsed Time
      %th.right Builder
      %th Build Artifacts
      %th Actions
  %tbody
    - @build_part.build_attempts.each_with_index do |attempt, index|
      %tr
        %td= index + 1
        %td.result-column
          %span.attempt-status{:class => attempt.state}= attempt.state.to_s.capitalize
        %td= attempt.started_at
        %td.right= duration_strftime(attempt.elapsed_time)
        %td.right= attempt.builder
        %td
          -# ci_reporter in square-web generates a bunch of xml files that we
          -# do not want to show in the web interface.
          - attempt.build_artifacts.reject {|artifact| artifact.log_file.path =~ /\.xml\.gz/}.each do |artifact|
            = link_to File.basename(artifact.log_file.to_s), artifact.log_file.url
            %br
        %td
          - if attempt.unsuccessful? && @build_part.unsuccessful?
            = link_to("Rebuild", rebuild_project_build_part_path(@project, @build, @build_part), :method => :post)
          - if attempt.running?
            = link_to("Abandon", finish_build_attempt_path(attempt, :state => :errored), :method => :post)

%ol#build-paths
  - @build_part.paths.each do |path|
    %li=path
